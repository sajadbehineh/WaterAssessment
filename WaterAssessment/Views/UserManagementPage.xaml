<?xml version="1.0" encoding="utf-8" ?>
<Page
    x:Class="WaterAssessment.Views.UserManagementPage"
    xmlns="http://schemas.microsoft.com/winfx/2006/xaml/presentation"
    xmlns:x="http://schemas.microsoft.com/winfx/2006/xaml"
    xmlns:converters="using:WaterAssessment.Converters"
    xmlns:d="http://schemas.microsoft.com/expression/blend/2008"
    xmlns:localControls="using:WaterAssessment.Controls"
    xmlns:mc="http://schemas.openxmlformats.org/markup-compatibility/2006"
    xmlns:models="using:WaterAssessment.Models"
    x:Name="UserManagementPageRoot"
    Background="{ThemeResource ApplicationPageBackgroundThemeBrush}"
    FontFamily="{StaticResource ContentControlThemeFontFamily}"
    mc:Ignorable="d">
    <Page.Resources>
        <converters:RowIndexConverter
            x:Key="RowIndexConverter"
            CurrentPage="{x:Bind ViewModel.CurrentPage, Mode=OneWay}"
            ItemsSource="{x:Bind ViewModel.Users, Mode=OneWay}"
            PageSize="10" />
    </Page.Resources>
    <Grid
        x:Name="UserManagementGrid"
        Padding="15"
        FlowDirection="RightToLeft">
        <Grid.ColumnDefinitions>
            <ColumnDefinition Width="350" />
            <ColumnDefinition Width="2*" />
        </Grid.ColumnDefinitions>

        <StackPanel
            Grid.Row="0"
            MaxWidth="600"
            Margin="0,0,0,30"
            Spacing="10">
            <TextBlock
                FontSize="25"
                FontWeight="Bold"
                Text="افزودن کاربر جدید" />
            <TextBox Header="نام کاربری" Text="{x:Bind ViewModel.NewUsername, Mode=TwoWay, UpdateSourceTrigger=PropertyChanged}" />
            <PasswordBox
                x:Name="NewUserPasswordBox"
                Header="رمز عبور"
                PasswordChanged="OnPasswordChanged" />
            <TextBox Header="نام کامل" Text="{x:Bind ViewModel.NewFullName, Mode=TwoWay, UpdateSourceTrigger=PropertyChanged}" />
            <ComboBox
                Header="نقش"
                ItemsSource="{x:Bind ViewModel.Roles}"
                SelectedItem="{x:Bind ViewModel.SelectedRole, Mode=TwoWay}" />
            <StackPanel Orientation="Horizontal" Spacing="10">
                <Button
                    HorizontalAlignment="Stretch"
                    Command="{x:Bind ViewModel.AddUserCommand}"
                    CommandParameter="{x:Bind NewUserPasswordBox}"
                    Content="{x:Bind ViewModel.AddEditButtonContent, Mode=OneWay}"
                    Style="{ThemeResource AccentButtonStyle}" />
                <Button
                    HorizontalAlignment="Stretch"
                    Command="{x:Bind ViewModel.ClearFormCommand}"
                    CommandParameter="{x:Bind NewUserPasswordBox}"
                    Content="پاک کردن"
                    Style="{ThemeResource AccentButtonStyle}" />
            </StackPanel>
            <InfoBar
                IsClosable="False"
                IsOpen="{x:Bind ViewModel.IsInfoBarOpen, Mode=TwoWay}"
                Message="{x:Bind ViewModel.InfoBarMessage, Mode=OneWay}"
                Severity="{x:Bind ViewModel.InfoBarSeverity, Mode=OneWay}" />
        </StackPanel>
        <Border
            Grid.Column="1"
            Width="520"
            Margin="40,10"
            HorizontalAlignment="Left"
            VerticalAlignment="Top"
            Background="{ThemeResource CardBackgroundFillColorDefaultBrush}"
            BorderBrush="LightGray"
            BorderThickness="1"
            CornerRadius="8"
            Translation="0 0 32">
            <Border.Shadow>
                <ThemeShadow />
            </Border.Shadow>
            <Grid DataContext="{x:Bind ViewModel}">
                <Grid.RowDefinitions>
                    <RowDefinition Height="Auto" />
                    <RowDefinition Height="*" />
                    <RowDefinition Height="Auto" />
                </Grid.RowDefinitions>
                <Grid
                    Grid.Row="0"
                    MinHeight="48"
                    Background="{ThemeResource SystemAccentColor}"
                    CornerRadius="8 8 0 0">
                    <Grid.ColumnDefinitions>
                        <ColumnDefinition Width="Auto" MinWidth="52" />
                        <ColumnDefinition Width="Auto" MinWidth="120" />
                        <ColumnDefinition Width="Auto" MinWidth="120" />
                        <ColumnDefinition Width="Auto" MinWidth="150" />
                        <ColumnDefinition Width="68" />
                    </Grid.ColumnDefinitions>
                    <TextBlock
                        Grid.Row="0"
                        HorizontalAlignment="Center"
                        VerticalAlignment="Center"
                        Foreground="{ThemeResource SystemAltHighColor}"
                        Text="ردیف" />
                    <Rectangle
                        Grid.Column="0"
                        Width="1"
                        HorizontalAlignment="Right"
                        VerticalAlignment="Stretch"
                        Opacity="0.5" />
                    <TextBlock
                        Grid.Column="1"
                        HorizontalAlignment="Center"
                        VerticalAlignment="Center"
                        Foreground="{ThemeResource SystemAltHighColor}"
                        Text="نام کاربری" />
                    <Rectangle
                        Grid.Column="1"
                        Width="1"
                        HorizontalAlignment="Right"
                        VerticalAlignment="Stretch"
                        Opacity="0.5" />
                    <TextBlock
                        Grid.Column="2"
                        HorizontalAlignment="Center"
                        VerticalAlignment="Center"
                        Foreground="{ThemeResource SystemAltHighColor}"
                        Text="نام" />
                    <Rectangle
                        Grid.Column="2"
                        Width="1"
                        HorizontalAlignment="Right"
                        VerticalAlignment="Stretch"
                        Opacity="0.5" />
                    <TextBlock
                        Grid.Column="3"
                        HorizontalAlignment="Center"
                        VerticalAlignment="Center"
                        Foreground="{ThemeResource SystemAltHighColor}"
                        Text="نقش" />
                    <Rectangle
                        Grid.Column="3"
                        Width="1"
                        HorizontalAlignment="Right"
                        VerticalAlignment="Stretch"
                        Opacity="0.5" />
                    <TextBlock
                        Grid.Column="4"
                        HorizontalAlignment="Center"
                        VerticalAlignment="Center"
                        Foreground="{ThemeResource SystemAltHighColor}"
                        Text="عملیات" />

                </Grid>
                <ListView
                    Name="UserListView"
                    Grid.Row="1"
                    ItemContainerStyle="{StaticResource HorizontalSwipe}"
                    ItemsSource="{x:Bind ViewModel.Users, Mode=OneWay}"
                    SelectedItem="{x:Bind ViewModel.SelectedUser, Mode=TwoWay}"
                    SelectionMode="Single">
                    <ListView.ItemTemplate>
                        <DataTemplate x:DataType="models:User">
                            <UserControl
                                FontFamily="{StaticResource SamimFD}"
                                PointerEntered="UserSwipeContainer_PointerEntered"
                                PointerExited="UserSwipeContainer_PointerExited">
                                <Grid Height="Auto">
                                    <SwipeControl Height="Auto">
                                        <Grid>
                                            <Grid.ColumnDefinitions>
                                                <ColumnDefinition Width="Auto" MinWidth="52" />
                                                <ColumnDefinition Width="Auto" MinWidth="120" />
                                                <ColumnDefinition Width="Auto" MinWidth="120" />
                                                <ColumnDefinition Width="Auto" MinWidth="150" />
                                                <ColumnDefinition Width="68" />
                                            </Grid.ColumnDefinitions>
                                            <TextBlock
                                                x:Name="IndexTextBlock"
                                                Grid.Column="0"
                                                HorizontalAlignment="Center"
                                                VerticalAlignment="Center"
                                                FontSize="12"
                                                Foreground="{ThemeResource SystemBaseHighColor}"
                                                Text="{Binding Converter={StaticResource RowIndexConverter}, Mode=OneWay}" />
                                            <TextBlock
                                                Grid.Column="1"
                                                HorizontalAlignment="Center"
                                                VerticalAlignment="Center"
                                                Text="{x:Bind Username}" />
                                            <TextBlock
                                                Grid.Column="2"
                                                HorizontalAlignment="Center"
                                                VerticalAlignment="Center"
                                                Text="{x:Bind FullName}" />
                                            <TextBlock
                                                Grid.Column="3"
                                                HorizontalAlignment="Center"
                                                VerticalAlignment="Center"
                                                Text="{x:Bind Role}" />
                                            <AppBarButton
                                                x:Name="btnHoverDeleteLocation"
                                                Grid.Column="4"
                                                Width="60"
                                                Height="60"
                                                HorizontalAlignment="Right"
                                                Command="{Binding ElementName=UserListView, Path=DataContext.DeleteUserCommand}"
                                                CommandParameter="{x:Bind}"
                                                Icon="Delete"
                                                IsTabStop="False"
                                                Label="حذف"
                                                Visibility="Collapsed">
                                                <AppBarButton.Resources>
                                                    <SolidColorBrush x:Key="AppBarButtonForeground" Color="Red" />
                                                    <SolidColorBrush x:Key="AppBarButtonForegroundPointerOver" Color="DarkRed" />
                                                    <SolidColorBrush x:Key="AppBarButtonForegroundPressed" Color="DarkRed" />
                                                </AppBarButton.Resources>
                                            </AppBarButton>
                                        </Grid>
                                    </SwipeControl>

                                    <VisualStateManager.VisualStateGroups>
                                        <VisualStateGroup x:Name="HoveringStates">
                                            <VisualState x:Name="HoverButtonsHidden" />
                                            <VisualState x:Name="HoverButtonsShown">
                                                <VisualState.Setters>
                                                    <Setter Target="btnHoverDeleteLocation.Visibility" Value="Visible" />
                                                </VisualState.Setters>
                                            </VisualState>
                                        </VisualStateGroup>
                                    </VisualStateManager.VisualStateGroups>
                                </Grid>
                            </UserControl>
                        </DataTemplate>
                    </ListView.ItemTemplate>
                </ListView>
                <localControls:PaginationControl
                    Grid.Row="2"
                    HorizontalAlignment="Center"
                    CurrentPage="{x:Bind ViewModel.CurrentPage, Mode=TwoWay}"
                    FlowDirection="LeftToRight"
                    PageChangedCommand="{x:Bind ViewModel.PageChangedCommand}"
                    PageSize="10"
                    TotalItemCount="{x:Bind ViewModel.TotalUsers, Mode=OneWay}" />
            </Grid>
        </Border>
    </Grid>
</Page>
